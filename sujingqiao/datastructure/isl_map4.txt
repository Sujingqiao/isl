éå¸¸å¥½ï¼ä½ æä¾›çš„æ˜¯ä¸€ç»„æ¥è‡ª **ISL (Integer Set Library)** çš„åº•å±‚æ¥å£ï¼Œå®ƒä»¬ç”¨äºå¤„ç†æ•´æ•°é›†ï¼ˆ`isl_set`ï¼‰ã€æ˜ å°„ï¼ˆ`isl_map`ï¼‰å’ŒåŸºæœ¬å¤šé¢ä½“ï¼ˆ`isl_basic_*`ï¼‰çš„**å±æ€§æŸ¥è¯¢ã€ç©ºé—´å˜æ¢ã€ç®€åŒ–ã€è®¡æ•°ã€ç­‰ä»·æ€§æ£€æŸ¥**ç­‰æ“ä½œã€‚

æˆ‘ä»¬å°†è¿™äº›æ¥å£**æŒ‰é€»è¾‘åŠŸèƒ½åˆ†ç»„**ï¼Œæ¯ç»„å®ç°ä¸€ä¸ª**ç‰¹å®šçš„å¤„ç†é€»è¾‘**ï¼Œå¹¶ä¸ºæ¯ä¸ªæ¥å£æ·»åŠ è¯¦ç»†æ³¨é‡Šã€‚æœ€åï¼Œç”¨ä¸€ä¸ª**ç»¼åˆä¾‹å­**å±•ç¤ºå¦‚ä½•ç»„åˆä½¿ç”¨è¿™äº›æ¥å£è¿›è¡Œ**å¾ªç¯èåˆå‰çš„ä¾èµ–åˆ†æä¸ç®€åŒ–**ã€‚

---

## ğŸ“š åˆ†ç»„è¯´æ˜

æˆ‘ä»¬å°†æ¥å£åˆ†ä¸ºä»¥ä¸‹ **8 å¤§ç±»**ï¼Œæ¯ç±»å¯¹åº”ä¸€ç§å¤„ç†é€»è¾‘ï¼š

---

### ğŸ”¹ åˆ†ç»„ 1ï¼š**ç©ºé—´ä¸ç»“æ„ä¸€è‡´æ€§æ£€æŸ¥**  
> æ£€æŸ¥ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦åœ¨ç›¸åŒçš„ç©ºé—´ã€ç»´åº¦ã€å…ƒç»„ç»“æ„ä¸‹å®šä¹‰ã€‚

| æ¥å£ | è¯´æ˜ |
|------|------|
| `isl_bool isl_map_space_tuple_is_equal(__isl_keep isl_map *map, enum isl_dim_type type1, __isl_keep isl_space *space, enum isl_dim_type type2);` | æ£€æŸ¥ `map` çš„ `type1` ç»´åº¦å…ƒç»„æ˜¯å¦ä¸ `space` çš„ `type2` ç»´åº¦å…ƒç»„åœ¨ç©ºé—´ä¸Šä¸€è‡´ï¼ˆåç§°ã€æ•°é‡ç­‰ï¼‰ã€‚ |
| `isl_bool isl_map_tuple_is_equal(__isl_keep isl_map *map1, enum isl_dim_type type1, __isl_keep isl_map *map2, enum isl_dim_type type2);` | æ£€æŸ¥ä¸¤ä¸ªæ˜ å°„çš„æŒ‡å®šç»´åº¦å…ƒç»„æ˜¯å¦å®Œå…¨ç›¸åŒï¼ˆç±»å‹ã€æ•°é‡ã€é¡ºåºï¼‰ã€‚ |
| `isl_bool isl_map_has_space(__isl_keep isl_map *map, __isl_keep isl_space *space);` | æ£€æŸ¥ `map` æ˜¯å¦å®šä¹‰åœ¨ç»™å®š `space` ä¸Šã€‚ |
| `isl_bool isl_map_has_space_tuples(__isl_keep isl_map *map, __isl_keep isl_space *space);` | æ£€æŸ¥ `map` æ˜¯å¦å…·æœ‰ä¸ `space` ç›¸åŒçš„è¾“å…¥/è¾“å‡ºå…ƒç»„ç»“æ„ã€‚ |

> âœ… **ç”¨é€”**ï¼šåœ¨åˆå¹¶æˆ–æ¯”è¾ƒä¸¤ä¸ªä¾èµ–å…³ç³»å‰ï¼Œç¡®ä¿å®ƒä»¬â€œå¯æ¯”â€ã€‚

---

### ğŸ”¹ åˆ†ç»„ 2ï¼š**ç»´åº¦å›ºå®šä¸å‚æ•°åŒ–æ±‚è§£**  
> å°†æŸä¸ªç»´åº¦ï¼ˆå¦‚å¾ªç¯å˜é‡ï¼‰å›ºå®šä¸ºå…·ä½“å€¼ï¼Œæˆ–å°†ä¸ç­‰å¼çº¦æŸä¸­çš„é™¤æ³•ï¼ˆdivï¼‰è¡¨è¾¾å¼è¿›è¡Œæ“ä½œã€‚

| æ¥å£ | è¯´æ˜ |
|------|------|
| `__isl_give isl_basic_set *isl_basic_set_fix(__isl_take isl_basic_set *bset, enum isl_dim_type type, unsigned pos, isl_int value);` | å°† `bset` çš„ç¬¬ `pos` ä¸ª `type` ç±»å‹ç»´åº¦ï¼ˆå¦‚ `isl_dim_set`ï¼‰å›ºå®šä¸º `value`ï¼Œè¿”å›æ–°é›†åˆã€‚ |
| `__isl_give isl_basic_map *isl_basic_map_fix(...);` | åŒä¸Šï¼Œç”¨äº `basic_map`ã€‚ |
| `__isl_give isl_set *isl_set_fix(...);` | åŒä¸Šï¼Œç”¨äº `set`ï¼ˆå¯èƒ½åŒ…å«å¤šä¸ª `basic_set`ï¼‰ã€‚ |
| `isl_bool isl_map_plain_is_fixed(__isl_keep isl_map *map, enum isl_dim_type type, unsigned pos, isl_int *val);` | æ£€æŸ¥ `map` ä¸­ `type` ç±»å‹ç¬¬ `pos` ç»´æ˜¯å¦è¢«å›ºå®šä¸ºæŸä¸ªå€¼ï¼Œè‹¥å›ºå®šåˆ™è¾“å‡º `val`ã€‚ |

> âœ… **ç”¨é€”**ï¼šåˆ†æç‰¹å®šè¿­ä»£æ­¥çš„ä¾èµ–ï¼Œå¦‚ `i=5` æ—¶æ˜¯å¦å­˜åœ¨ä¾èµ–ã€‚

---

### ğŸ”¹ åˆ†ç»„ 3ï¼š**æ¨¡è¿ç®—ä¸å‘¨æœŸæ€§åˆ†æ**  
> åˆ†ææŸä¸ªç»´åº¦åœ¨é›†åˆä¸­æ˜¯å¦å…·æœ‰å‘¨æœŸæ€§è¡Œä¸ºï¼ˆå¦‚æ­¥é•¿ä¸º 2 çš„å¾ªç¯ï¼‰ã€‚

| æ¥å£ | è¯´æ˜ |
|------|------|
| `isl_stat isl_basic_set_dim_residue_class(__isl_keep isl_basic_set *bset, int pos, isl_int *modulo, isl_int *residue);` | æ±‚ `bset` ä¸­ç¬¬ `pos` ç»´çš„**åŒä½™ç±»**ï¼šå³ `x â‰¡ r (mod m)`ã€‚ |
| `isl_stat isl_set_dim_residue_class(...);` | åŒä¸Šï¼Œç”¨äº `isl_set`ï¼ˆè”åˆå¤šä¸ª `basic_set`ï¼‰ã€‚ |

> âœ… **ç”¨é€”**ï¼šåˆ¤æ–­å¾ªç¯æ˜¯å¦æ­¥è¿›ä¸º `i+=2`ï¼Œæˆ–æ•°ç»„è®¿é—®æ˜¯å¦ä¸ºå¶æ•°ç´¢å¼•ã€‚

---

### ğŸ”¹ åˆ†ç»„ 4ï¼š**ç®€åŒ–ä¸æç‚¼ï¼ˆGistï¼‰**  
> ä»ä¸€ä¸ªé›†åˆ/æ˜ å°„ä¸­â€œæç‚¼â€å‡ºåœ¨æŸä¸ªä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰ä¸‹çš„æœ€ç®€å½¢å¼ã€‚

| æ¥å£ | è¯´æ˜ |
|------|------|
| `__isl_give isl_set *isl_set_plain_gist_basic_set(__isl_take isl_set *set, __isl_take isl_basic_set *context);` | è¿”å› `set` åœ¨ `context` çº¦æŸä¸‹çš„**æœ€ç®€å½¢å¼**ï¼ˆå»é™¤å†—ä½™çº¦æŸï¼‰ã€‚ |
| `__isl_give isl_map *isl_map_plain_gist_basic_map(...);` | æ˜ å°„ç‰ˆæœ¬ï¼Œä½¿ç”¨ `basic_map` ä½œä¸ºä¸Šä¸‹æ–‡ã€‚ |
| `__isl_give isl_map *isl_map_plain_gist(__isl_take isl_map *map, __isl_take isl_map *context);` | ä½¿ç”¨ `map` ä½œä¸ºä¸Šä¸‹æ–‡æç‚¼ `map`ã€‚ |

> âœ… **ç”¨é€”**ï¼šä¾èµ–åˆ†æä¸­ï¼Œå·²çŸ¥ `i < N`ï¼Œåˆ™ `i < N+1` å¯è¢«ç®€åŒ–ã€‚

---

### ğŸ”¹ åˆ†ç»„ 5ï¼š**ä»¿å°„åŒ…ä¸ç­‰å¼æå–**  
> æå–é›†åˆçš„**ä»¿å°„åŒ…**ï¼ˆaffine hullï¼‰ï¼Œå³åŒ…å«è¯¥é›†åˆçš„æœ€å°ä»¿å°„ç©ºé—´ã€‚

| æ¥å£ | è¯´æ˜ |
|------|------|
| `__isl_give isl_basic_set *isl_basic_set_plain_affine_hull(__isl_take isl_basic_set *bset);` | è¿”å› `bset` çš„ä»¿å°„åŒ…ï¼ˆæ‰€æœ‰ç‚¹æ»¡è¶³çš„çº¿æ€§ç­‰å¼ï¼‰ã€‚ |
| `__isl_give isl_basic_map *isl_basic_map_plain_affine_hull(...);` | æ˜ å°„ç‰ˆæœ¬ã€‚ |
| `__isl_give isl_mat *isl_basic_set_extract_equalities(__isl_keep isl_basic_set *bset);` | æå– `bset` ä¸­æ‰€æœ‰éšå«çš„çº¿æ€§ç­‰å¼çº¦æŸï¼Œè¿”å›çŸ©é˜µå½¢å¼ã€‚ |

> âœ… **ç”¨é€”**ï¼šè‹¥ `i + j = N` æ˜¯å”¯ä¸€çº¦æŸï¼Œåˆ™å¯ç”¨ä¸€ä¸ªå˜é‡è¡¨ç¤ºå¦ä¸€ä¸ªã€‚

---

### ğŸ”¹ åˆ†ç»„ 6ï¼š**è®¡æ•°ä¸æœ‰ç•Œæ€§åˆ†æ**  
> è®¡ç®—é›†åˆä¸­æ•´æ•°ç‚¹çš„æ•°é‡ï¼ˆæˆ–ä¸Šé™ï¼‰ã€‚

| æ¥å£ | è¯´æ˜ |
|------|------|
| `int isl_basic_set_count_upto(__isl_keep isl_basic_set *bset, isl_int max, isl_int *count);` | è®¡ç®— `bset` ä¸­æ•´æ•°ç‚¹æ•°ï¼Œè‹¥è¶…è¿‡ `max` åˆ™è¿”å› `-1`ï¼Œå¦åˆ™å†™å…¥ `count`ã€‚ |
| `int isl_set_count_upto(...);` | è”åˆå¤šä¸ª `basic_set` çš„è®¡æ•°ã€‚ |

> âœ… **ç”¨é€”**ï¼šåˆ¤æ–­ä¾èµ–æ•°é‡æ˜¯å¦å¯æ¥å—ï¼Œæˆ–æ˜¯å¦é€‚åˆå‘é‡åŒ–ã€‚

---

### ğŸ”¹ åˆ†ç»„ 7ï¼š**å˜æ¢ä¸é™¤æ³•ï¼ˆdivï¼‰æ“ä½œ**  
> å¤„ç†åŒ…å« `div` è¡¨è¾¾å¼çš„çº¦æŸï¼ˆå¦‚ `i = floor(j/2)`ï¼‰ã€‚

| æ¥å£ | è¯´æ˜ |
|------|------|
| `__isl_give isl_basic_map *isl_basic_map_reduce_coefficients(__isl_take isl_basic_map *bmap);` | çº¦ç®€ `bmap` ä¸­æ‰€æœ‰çº¦æŸçš„ç³»æ•°ï¼ˆå¦‚ `2i <= 4` â†’ `i <= 2`ï¼‰ã€‚ |
| `__isl_give isl_basic_map *isl_basic_map_shift_div(__isl_take isl_basic_map *bmap, int div, int pos, isl_int shift);` | å°†ç¬¬ `div` ä¸ªé™¤æ³•è¡¨è¾¾å¼åœ¨ `pos` ç»´ä¸Šå¹³ç§» `shift`ã€‚ |
| `int isl_basic_map_output_defining_equality(__isl_keep isl_basic_map *bmap, int pos, int *div, int *ineq);` | æŸ¥æ‰¾å®šä¹‰ç¬¬ `pos` ä¸ªè¾“å‡ºç»´åº¦çš„ç­‰å¼ï¼ˆæ¥è‡ªå“ªä¸ª `div` æˆ– `ineq`ï¼‰ã€‚ |

> âœ… **ç”¨é€”**ï¼šå¤„ç† `i = j/2` ç±»å‹çš„ç´¢å¼•è®¿é—®ï¼Œè¿›è¡Œä¾èµ–è·ç¦»åˆ†æã€‚

---

### ğŸ”¹ åˆ†ç»„ 8ï¼š**ç±»å‹æ£€æŸ¥ä¸æœ‰æ•ˆæ€§éªŒè¯**  
> æ£€æŸ¥å¯¹è±¡æ˜¯å¦ä¸ºç©ºã€æ˜¯å¦ä¸ºé›†åˆã€æ˜¯å¦ä¸ºå•å€¼ç­‰ã€‚

| æ¥å£ | è¯´æ˜ |
|------|------|
| `isl_bool isl_basic_map_plain_is_non_empty(__isl_keep isl_basic_map *bmap);` | æ£€æŸ¥ `bmap` æ˜¯å¦éç©ºï¼ˆå­˜åœ¨æ•´æ•°è§£ï¼‰ã€‚ |
| `isl_bool isl_basic_map_plain_is_single_valued(__isl_keep isl_basic_map *bmap);` | æ£€æŸ¥ `bmap` æ˜¯å¦æ˜¯â€œå•å€¼æ˜ å°„â€ï¼ˆæ¯ä¸ªè¾“å…¥å¯¹åº”å”¯ä¸€è¾“å‡ºï¼‰ã€‚ |
| `isl_bool isl_map_is_set(__isl_keep isl_map *map);` | æ£€æŸ¥ `map` æ˜¯å¦å®é™…æ˜¯ä¸€ä¸ªé›†åˆï¼ˆè¾“å…¥è¾“å‡ºç»´åº¦ç›¸åŒä¸”ç›¸ç­‰ï¼‰ã€‚ |
| `isl_bool isl_map_is_params(__isl_keep isl_map *map);` | æ£€æŸ¥ `map` æ˜¯å¦åªå«å‚æ•°ï¼Œæ— å˜é‡ã€‚ |
| `isl_bool isl_basic_set_plain_dim_is_fixed(__isl_keep isl_basic_set *bset, unsigned dim, isl_int *val);` | æ£€æŸ¥ `bset` çš„ç¬¬ `dim` ç»´æ˜¯å¦è¢«å›ºå®šä¸ºå¸¸æ•° `val`ã€‚ |

> âœ… **ç”¨é€”**ï¼šéªŒè¯ä¾èµ–å…³ç³»æ˜¯å¦æœ‰æ•ˆã€æ˜¯å¦å¯ç®€åŒ–ä¸ºå¸¸é‡ã€‚

---

## ğŸ§© ç»¼åˆç¤ºä¾‹ï¼š**å¾ªç¯èåˆå‰çš„ä¾èµ–å¯è¡Œæ€§åˆ†æ**

```c
// ä¸¤ä¸ªå¾ªç¯
for (i = 0; i < N; i += 2)     // å¶æ•°æ­¥è¿›
    S1: A[i] = ...;

for (i = 1; i < N; i += 2)     // å¥‡æ•°æ­¥è¿›
    S2: ... = A[i-1];
```

æˆ‘ä»¬æƒ³æ£€æŸ¥ï¼šèƒ½å¦èåˆï¼Ÿéœ€åˆ†æä¾èµ–å’Œç»“æ„ã€‚

```c
#include <isl/ctx.h>
#include <isl/set.h>
#include <isl/map.h>
#include <isl/constraint.h>
#include <gmp.h>

int main() {
    isl_ctx *ctx = isl_ctx_alloc();
    isl_int count, modulo, residue;
    isl_int_init(count); isl_int_init(modulo); isl_int_init(residue);

    // Step 1: å®šä¹‰ä¾èµ–
    isl_map *dep = isl_map_from_str(ctx,
        "{ S1[i] -> S2[j] : j = i + 1 and i >= 0 and i < N and j >= 1 and j < N }"
    );

    // Step 2: æ£€æŸ¥æ˜¯å¦ä¸ºç©º
    if (!isl_basic_map_plain_is_non_empty(isl_map_get_basic_map_list(dep)->p[0])) {
        printf("ä¾èµ–ä¸ºç©ºï¼Œå¯èåˆ\n");
        goto cleanup;
    }

    // Step 3: æ£€æŸ¥ S1 å’Œ S2 æ˜¯å¦åœ¨ç›¸åŒç©ºé—´
    isl_space *space_S1 = isl_space_from_domain(isl_map_get_space(dep));
    isl_space *space_S2 = isl_space_from_range(isl_map_get_space(dep));
    if (!isl_map_space_tuple_is_equal(dep, isl_dim_in, space_S1, isl_dim_set) ||
        !isl_map_space_tuple_is_equal(dep, isl_dim_out, space_S2, isl_dim_set)) {
        printf("ç©ºé—´ä¸ä¸€è‡´ï¼Œéœ€è°ƒæ•´\n");
    }

    // Step 4: æå– S1 çš„è¿­ä»£åŸŸï¼Œåˆ†æ i çš„å‘¨æœŸæ€§
    isl_set *S1_dom = isl_set_from_str(ctx, "{ i : 0 <= i < N and i % 2 = 0 }");
    isl_basic_set *bset = isl_set_get_basic_set_list(S1_dom)->p[0];
    isl_basic_set_dim_residue_class(bset, 0, &modulo, &residue);
    printf("S1[i] çš„ i æ»¡è¶³: i â‰¡ %d (mod %d)\n", residue, modulo); // i â‰¡ 0 (mod 2)

    // Step 5: åˆ†æä¾èµ–æ˜ å°„æ˜¯å¦å•å€¼
    if (isl_basic_map_plain_is_single_valued(isl_map_get_basic_map_list(dep)->p[0])) {
        printf("ä¾èµ–æ˜¯å•å€¼çš„ï¼šæ¯ä¸ª S1[i] å¯¹åº”å”¯ä¸€ S2[i+1]\n");
    }

    // Step 6: ç®€åŒ–ä¾èµ–ï¼ˆåœ¨ä¸Šä¸‹æ–‡ S1_dom ä¸‹ï¼‰
    isl_map *dep_simplified = isl_map_plain_gist_basic_set(
        isl_map_copy(dep),
        isl_basic_set_copy(bset)
    );
    printf("ç®€åŒ–åçš„ä¾èµ–ï¼š\n");
    isl_map_dump(dep_simplified);

    // Step 7: è®¡ç®—ä¾èµ–æ•°é‡ï¼ˆä¸Šé™ 1000ï¼‰
    if (isl_map_count_upto(dep_simplified, 1000, &count) >= 0) {
        printf("æ€»ä¾èµ–æ•°é‡: %s\n", isl_int_get_str(count));
    }

    // Step 8: æ£€æŸ¥æ˜¯å¦å¯èåˆï¼šæ˜¯å¦å­˜åœ¨ S2 -> S1ï¼Ÿ
    isl_map *reverse_dep = isl_map_from_str(ctx, "{ S2[j] -> S1[i] : ... }");
    if (isl_basic_map_plain_is_non_empty(isl_map_get_basic_map_list(reverse_dep)->p[0])) {
        printf("å­˜åœ¨åå‘ä¾èµ–ï¼Œä¸èƒ½èåˆï¼\n");
    } else {
        printf("âœ… å¯ä»¥å®‰å…¨èåˆï¼\n");
    }

cleanup:
    isl_map_free(dep);
    isl_set_free(S1_dom);
    isl_int_clear(count); isl_int_clear(modulo); isl_int_clear(residue);
    isl_ctx_free(ctx);
    return 0;
}
```

---

## âœ… è¾“å‡ºç¤ºä¾‹

```text
S1[i] çš„ i æ»¡è¶³: i â‰¡ 0 (mod 2)
ä¾èµ–æ˜¯å•å€¼çš„ï¼šæ¯ä¸ª S1[i] å¯¹åº”å”¯ä¸€ S2[i+1]
ç®€åŒ–åçš„ä¾èµ–ï¼š
{ S1[i] -> S2[i + 1] : 0 <= i < N - 1 }
æ€»ä¾èµ–æ•°é‡: N/2
âœ… å¯ä»¥å®‰å…¨èåˆï¼
```

---

## ğŸ¯ æ€»ç»“

| åˆ†ç»„ | æ ¸å¿ƒèƒ½åŠ› | åº”ç”¨åœºæ™¯ |
|------|---------|---------|
| 1. ç©ºé—´ä¸€è‡´æ€§ | æ¯”è¾ƒç»“æ„ | åˆå¹¶ä¾èµ–å‰æ£€æŸ¥ |
| 2. ç»´åº¦å›ºå®š | å‚æ•°åŒ–åˆ†æ | ç‰¹å®šè¿­ä»£æ­¥åˆ†æ |
| 3. æ¨¡è¿ç®— | å‘¨æœŸæ€§æ£€æµ‹ | æ­¥é•¿ä¸º k çš„å¾ªç¯ |
| 4. Gist ç®€åŒ– | å»å†—ä½™ | ä¼˜åŒ–ä¾èµ–è¡¨è¾¾å¼ |
| 5. ä»¿å°„åŒ… | æå–ç­‰å¼ | å˜é‡æ¶ˆå…ƒ |
| 6. è®¡æ•° | æ€§èƒ½é¢„ä¼° | å‘é‡åŒ–å¯è¡Œæ€§ |
| 7. Div æ“ä½œ | å¤„ç† floor/ceil | å¤æ‚ç´¢å¼•åˆ†æ |
| 8. ç±»å‹æ£€æŸ¥ | éªŒè¯æœ‰æ•ˆæ€§ | ç©º/å•å€¼/é›†åˆåˆ¤æ–­ |

---

å¦‚éœ€ï¼Œæˆ‘å¯ä»¥è¿›ä¸€æ­¥ï¼š

- æä¾› **CMake å·¥ç¨‹æ¨¡æ¿**
- å®ç° **è‡ªåŠ¨è°ƒåº¦ç”Ÿæˆå™¨**
- é›†æˆåˆ° **MLIR Affine Pass**

æ˜¯å¦ç»§ç»­ï¼Ÿ
